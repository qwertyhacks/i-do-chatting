<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Socket Chat</title>
  <script src="/socket.io/socket.io.js"></script>
  <style>
    body { margin: 0; font-family: sans-serif; background-color: #36393f; color: #fff; }
    #login, #chat { display: none; }
    #login.active, #chat.active { display: flex; }

    #login {
      height: 100vh;
      justify-content: center;
      align-items: center;
      flex-direction: column;
    }

    #chat {
      height: 100vh;
      flex-direction: column;
    }

    .chat-messages {
      flex: 1;
      overflow-y: auto;
      padding: 1rem;
    }

    .message img {
      max-width: 200px;
      max-height: 200px;
      border-radius: 6px;
      display: block;
      margin-top: 5px;
    }

    input, button {
      padding: 10px;
      border-radius: 5px;
      border: none;
      margin: 5px;
    }
  </style>
</head>
<body>

<!-- Login UI -->
<div id="login" class="active">
  <h2>Enter Username</h2>
  <input type="text" id="usernameInput" placeholder="Your name..." />
  <button onclick="joinChat()">Join Chat</button>
</div>

<!-- Chat UI -->
<div id="chat">
  <div class="chat-messages" id="chatMessages"></div>
  <div class="message-input">
    <input type="text" id="messageInput" placeholder="Type a message..." />
    <button onclick="sendMessage()">Send</button>
  </div>
</div>

<script>
  const socket = io(https://i-do-chatting.onrender.com); // Connect to the server
  let username = "";

  // Handle user login
  function joinChat() {
    const input = document.getElementById("usernameInput");
    username = input.value.trim();
    if (username !== "") {
      document.getElementById("login").classList.remove("active");
      document.getElementById("chat").classList.add("active");
    }
  }

  // Send a message
  function sendMessage() {
    const input = document.getElementById("messageInput");
    const message = input.value.trim();
    if (message !== "") {
      socket.emit("chat message", { username, message });
      input.value = "";
    }
  }

  // Format and display message (with support for links and images)
  function formatMessage({ username, message }) {
    const div = document.createElement("div");
    div.classList.add("message");

    // Find and replace URLs with anchor tags or images
    const urlRegex = /(https?:\/\/[^\s]+)/g;
    let formattedMessage = message.replace(urlRegex, (url) => {
      if (/\.(jpeg|jpg|gif|png|webp)$/i.test(url)) {
        return `<img src="${url}" alt="image" />`; // Display image if URL points to an image
      }
      return `<a href="${url}" target="_blank">${url}</a>`; // Otherwise, create a link
    });

    div.innerHTML = `<strong style="color:#7289da">${username}:</strong> ${formattedMessage}`;
    return div;
  }

  // Listen for incoming messages
  socket.on("chat message", (data) => {
    const messages = document.getElementById("chatMessages");
    const msgElement = formatMessage(data);
    messages.appendChild(msgElement);
    messages.scrollTop = messages.scrollHeight; // Auto-scroll to the latest message
  });
</script>
</body>
</html>
